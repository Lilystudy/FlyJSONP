var FlyJSONP=(function(b){var j,g,d,a,e,h,i,f,c;g=function(k,m,l){if(k.addEventListener){k.addEventListener(m,l,false)}else{if(k.attachEvent){k.attachEvent("on"+m,l)}else{k["on"+m]=l}}};d=function(m,k){j.log("Garbage collecting!");k.parentNode.removeChild(k);b[m]=undefined;try{delete b[m]}catch(l){}};a=function(l,m){var n="",k,o;for(k in l){if(l.hasOwnProperty(k)){k=m?encodeURIComponent(k):k;o=m?encodeURIComponent(l[k]):l[k];n+=k+"="+o+"&"}}return n.replace(/&$/,"")};e=function(){var n="",m=[],k="0123456789ABCDEF",l=0;for(l=0;l<32;l+=1){m[l]=k.substr(Math.floor(Math.random()*16),1)}m[12]="4";m[16]=k.substr((m[16]&3)|8,1);n="flyjsonp_"+m.join("");return n};h=function(l,k){j.log(k);if(typeof(l)!=="undefined"){l(k)}};i=function(l,k){j.log("GET success");if(typeof(l)!=="undefined"){l(k)}j.log(k)};f=function(l,k){j.log("POST success");if(typeof(l)!=="undefined"){l(k)}j.log(k)};c=function(k){j.log("Request complete");if(typeof(k)!=="undefined"){k()}};j={};j.options={debug:false};j.init=function(k){var l;j.log("Initializing!");for(l in k){if(k.hasOwnProperty(l)){j.options[l]=k[l]}}j.log("Initialization options");j.log(j.options);return true};j.log=function(k){if(b.console&&j.options.debug){b.console.log(k)}};j.get=function(m){m=m||{};var l=m.url,o=m.callbackParameter||"callback",n=m.parameters||{},k=b.document.createElement("script"),q=e(),p="?";if(!l){throw new Error("URL must be specified!")}n[o]=q;if(l.indexOf("?")>=0){p="&"}l+=p+a(n,true);b[q]=function(r){if(typeof(r)==="undefined"){h(m.error,"Invalid JSON data returned")}else{if(m.httpMethod==="post"){r=r.query.results;if(!r||!r.postresult){h(m.error,"Invalid JSON data returned")}else{if(r.postresult.json){r=r.postresult.json}else{r=r.postresult}f(m.success,r)}}else{i(m.success,r)}}d(q,k);c(m.complete)};j.log("Getting JSONP data");k.setAttribute("src",l);b.document.getElementsByTagName("head")[0].appendChild(k);g(k,"error",function(){d(q,k);c(m.complete);h(m.error,"Error while trying to access the URL")})};j.post=function(l){l=l||{};var k=l.url,p=l.parameters||{},o,n,m={};if(!k){throw new Error("URL must be specified!")}o=encodeURIComponent('select * from jsonpost where url="'+k+'" and postdata="'+a(p,false)+'"');n="http://query.yahooapis.com/v1/public/yql?q="+o+"&format=json&env="+encodeURIComponent("store://datatables.org/alltableswithkeys");m.url=n;m.httpMethod="post";if(typeof(l.success)!=="undefined"){m.success=l.success}if(typeof(l.error)!=="undefined"){m.error=l.error}if(typeof(l.complete)!=="undefined"){m.complete=l.complete}j.get(m)};return j}(this));(function(a){var b=a.sammy("#dynamic",function(){var c="templates/";this.debug=false;this.use("Mustache");this.notFound=function(e,d){this.runRoute("get","#!/404")};this.get("/",function(){this.partial(c+"index.mustache").then(function(){this.trigger("done-loading-template")})});this.get("#!/start",function(){this.partial(c+"start.mustache").then(function(){this.trigger("done-loading-template")})});this.get("#!/demo",function(){var d={url:{value:"http://storify.com/xdamman.json"},method:{get:"selected"},callback:{value:"callback"},parameters:[{key:"limit",value:5}]};this.renderDemo(d)});this.get("#!/demo-get-tweets",function(){var d={url:{value:"https://api.twitter.com/1/statuses/user_timeline.json"},method:{get:"selected"},callback:{value:"callback"},parameters:[{key:"include_rts",value:true},{key:"screen_name",value:"alotaiba"},{key:"count",value:2}]};this.renderDemo(d)});this.get("#!/demo-get-reddit",function(){var d={url:{value:"http://www.reddit.com/.json"},method:{get:"selected"},callback:{value:"jsonp"},parameters:[{key:"limit",value:5}]};this.renderDemo(d)});this.get("#!/demo-get-flickr",function(){var d={url:{value:"http://api.flickr.com/services/feeds/photos_public.gne"},method:{get:"selected"},callback:{value:"jsoncallback"},parameters:[{key:"format",value:"json"}]};this.renderDemo(d)});this.get("#!/demo-post-story",function(){var d={url:{value:"http://storify.com/story/new"},method:{post:"selected"},parameters:[{key:"username",value:"your-user-name"},{key:"api_key",value:"your-api-key"},{key:"title",value:"FlyJSONP"},{key:"description",value:"Testing it out"}]};this.renderDemo(d)});this.get("#!/demo-post-tumblr",function(){var d={url:{value:"http://www.tumblr.com/api/write"},method:{post:"selected"},parameters:[{key:"email",value:"your-email"},{key:"password",value:"your-password"},{key:"type",value:"regular"},{key:"title",value:"Test FlyJSONP"},{key:"body",value:"Testing it out"}]};this.renderDemo(d)});this.get("#!/404",function(){this.partial(c+"404.mustache").then(function(){this.trigger("done-loading-template")})});this.post("#!/fetch",function(){this.trigger("form-submit")});this.helpers({jsonLeafType:function(h,f){var g,d,e=false;if(h===null){g={title:f+" : null",attr:{href:"javascript:;","data-type":"null","data-name":f,"data-value":"null"}}}else{if(typeof h==="string"){g={title:f+' : "'+h+'"',attr:{href:"javascript:;","data-type":"string","data-name":f,"data-value":h}}}else{if(typeof h==="number"){g={title:f+" : "+h,attr:{href:"javascript:;","data-type":"number","data-name":f,"data-value":h}}}else{if(typeof h==="boolean"){d=h?"true":"false";g={title:f+" : "+d,attr:{href:"javascript:;","data-type":"boolean","data-name":f,"data-value":d}}}else{if(typeof h==="object"){e=true;d="Object";if(h instanceof Array){d="Array"}g={title:f,attr:{href:"javascript:;","data-type":d,"data-name":f,"data-value":d}}}else{if(typeof h==="function"){g={title:f+" : function",attr:{href:"javascript:;","data-type":"function","data-name":f,"data-value":"function"}}}}}}}}return{data:g,containsChildren:(e===true)?e:false}},jsonToTree:function(f){var d=[];for(key in f){if(f.hasOwnProperty(key)){var e=this.jsonLeafType(f[key],key);if(e.containsChildren===true){d.push({data:e.data,children:this.jsonToTree(f[key])})}else{d.push({data:e.data})}}}return d},renderDemo:function(d){this.partial(c+"demo.mustache",d).then(function(e){this.trigger("form_update_fieldAddRemove");this.trigger("done-loading-template")})},flyJSONP:function(d,i,g,f){var e=this;var h={url:d,parameters:f,success:function(j){e.updateResultsTree(j)},error:function(j){a("#result_jsonp").text(j)}};if(i=="get"){h.callbackParameter=g;FlyJSONP.get(h)}else{if(i=="post"){FlyJSONP.post(h)}}},updateResultsTree:function(d){var e;if(typeof(d)==="object"){e=this.jsonToTree(d)}else{e={data:{title:d,attr:{href:"javascript:;","data-type":typeof(d),"data-name":"N/A","data-value":d}}}}a("#result_jsonp").jstree({themes:{icons:false},core:{animation:0},json_data:{data:e,progressive_render:false},plugins:["themes","json_data","ui"]}).delegate("a","click",function(f){var g=a(f.target).data();
b.trigger("jsonp_view_item_info",g);f.preventDefault()})}});this.bind("run",function(f,d){if(b.debug===false){b.log=function(){}}a("#form_method select").live("change",function(g){b.trigger("form_select_method_change",{element:a(this)})});a("#form_parameters .removeFormField").live("click",function(g){b.trigger("form_remove_parameter_field")});a("#form_parameters .addFormField").live("click",function(g){b.trigger("form_add_parameter_field")});a("#expand_all_link").live("click",function(g){b.trigger("jsonp_view_expand_all")});a("#collapse_all_link").live("click",function(g){b.trigger("jsonp_view_collapse_all")})});this.bind("form_select_method_change",function(g,f){var d=f.element.find(":selected").val();(d=="post")?a("#form_callback").hide():a("#form_callback").show()});this.bind("form_add_parameter_field",function(h,g){var f=a("<div/>").attr({"class":"grid_8 alpha params_fields"}).html('<div class="grid_3 alpha"><input type="text" id="keys" name="keys[]" placeholder="Key" required /></div><div class="grid_1"><p style="font-size: 1.6em; text-align: center">=</p></div><div class="grid_3"><input type="text" id="values" name="values[]" placeholder="Value" required /></div><div class="grid_1 omega fieldsAddRemove"></div>');var d=a("<div/>").attr({"class":"clear"});a("#form_parameters_fields").append(f).append(d);b.trigger("form_update_fieldAddRemove")});this.bind("form_remove_parameter_field",function(g,f){var d=a(".params_fields");if(d.length>1){a(event.target).closest(".params_fields").remove()}b.trigger("form_update_fieldAddRemove")});this.bind("form_update_fieldAddRemove",function(h,g){var d;var f=a(".params_fields");f.find(".fieldsAddRemove").empty();if(f.length==1){d=f.first().find(".fieldsAddRemove");d.html('<p style="font-size: 1.6em;"><a class="addFormField" href="javascript:;">+</a></p>')}else{f.each(function(j,k){var e=a(k).find(".fieldsAddRemove");e.html('<p style="font-size: 1.6em;"><a class="removeFormField" href="javascript:;">-</a></p>')});d=f.last().find(".fieldsAddRemove");d.html('<p style="font-size: 1.6em;"><a class="removeFormField" href="javascript:;">-</a><a class="addFormField" href="javascript:;">+</a></p>')}});this.bind("jsonp_view_expand_all",function(f,d){a("#result_jsonp").jstree("open_all",false)});this.bind("jsonp_view_collapse_all",function(f,d){a("#result_jsonp").jstree("close_all",false)});this.bind("jsonp_view_item_info",function(f,d){a.each(d,function(e,g){a(".data_"+e+"_value").text(g)})});this.bind("done-loading-template",function(f,d){prettyPrint()});this.bind("form-submit",function(k,i){var h=this.params;var g=this;a("#result_jsonp").text("Loading data...");var f=h.url;var d=h.method;var j=h.callback;var n=(typeof(h["keys[]"])==="string")?[h["keys[]"]]:h["keys[]"];var l=(typeof(h["values[]"])==="string")?[h["values[]"]]:h["values[]"];var m={};a.each(n,function(e,o){m[o]=l[e]});this.flyJSONP(f,d,j,m)})});a(function(){FlyJSONP.init({debug:false});b.run()})})(jQuery);window.log=function(){log.history=log.history||[];log.history.push(arguments);arguments.callee=arguments.callee.caller;if(this.console){console.log(Array.prototype.slice.call(arguments))}};(function(e){function h(){}for(var g="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),f;f=g.pop();){e[f]=e[f]||h}})(window.console=window.console||{});